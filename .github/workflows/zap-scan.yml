---
name: Run OWASP-ZAP Scan
on:
  # workflow_call:
  #   inputs:
  #     url:
  #       required: true
  #       type: string
  push:
    branches:
      - asteel/zap-action

jobs:
  zap_scan:
    name: Scan site with OWASP-ZAP
    runs-on: ubuntu-latest
    env:
      # url: ${{ inputs.url }}
      url: "https://fac-dev.app.cloud.gov"
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Get Date
        shell: bash
        id: date
        run: echo "date=$(date +%Y%m%d:%H%M)" >> $GITHUB_OUTPUT

      - name: ZAP Scan
        uses: zaproxy/action-full-scan@v0.5.1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          docker_name: 'owasp/zap2docker-stable'
          target: '${{ env.url }}'
          rules_file_name: 'zap.conf'
          cmd_options: '-a'
          allow_issue_writing: true
          fail_action: false
          issue_title: 'ZAP Scan Findings'

