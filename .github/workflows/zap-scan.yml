---
name: Run OWASP-ZAP Scan
on:
  # workflow_call:
  #   inputs:
  #     url:
  #       required: true
  #       type: string
  push:
    branches:
      - asteel/zap-action

jobs:
  zap-scan:
    name: Scan site with OWASP-ZAP
    runs-on: ubuntu-latest
    env:
      # url: ${{ inputs.url }}
      url: 'https://fac-dev.app.cloud.gov'
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: ZAP Scan of ${{ env.url }}
        uses: zaproxy/action-full-scan@v0.5.1
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          docker_name: 'owasp/zap2docker-stable'
          target: '${{ env.url }}'
          rules_file_name: 'zap.conf'
          cmd_options: '-z "-addoninstall ReportGeneration -autorun /zap/wrk/zap.yaml"'
          allow_issue_writing: false
          fail_action: false

      - name: Upload ZAP scan results to GitHub Security tab
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: '/zap/wrk/zap-report.sarif'
